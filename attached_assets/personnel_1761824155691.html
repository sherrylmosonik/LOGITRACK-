<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personnel Management | LogiTrack LMS</title>
  <style>
    /* ===== Global Theme ===== */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #638cd7 100%);
      min-height: 100vh;
      margin: 0;
      color: #fff;
      overflow-x: hidden;
    }

    .background-pattern {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.05;
      background-image: repeating-linear-gradient(0deg, transparent, transparent 50px, #fff 50px, #fff 51px),
                        repeating-linear-gradient(90deg, transparent, transparent 50px, #fff 50px, #fff 51px);
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }

    /* ===== Header ===== */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      margin-bottom: 1.5rem;
    }

    header h1 {
      font-size: 1.5rem;
      letter-spacing: 1px;
    }

    header button {
      background: #232991;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      color: #fff;
      font-weight: 500;
      transition: 0.3s;
    }

    header button:hover {
      background: #3942b7;
    }

    /* ===== Filters ===== */
    .filters {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .filters input, .filters select {
      padding: 0.6rem 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
      width: 220px;
    }

    /* ===== Table ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
      margin-bottom: 2rem;
    }

    th, td {
      padding: 1rem;
      text-align: left;
    }

    /* Keep the actions column a fixed width so buttons don't shift table layout when rows are added */
    table { table-layout: auto; }
    .actions { width: 140px; text-align: right; white-space: nowrap; }

    th {
      background: rgba(0, 0, 0, 0.3);
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
    }

    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.08);
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.15);
      transition: 0.3s;
    }

    .status-active {
      color: #00ffa9;
      font-weight: 500;
    }

    .status-off {
      color: #ff7e7e;
      font-weight: 500;
    }

    .actions button {
      margin-left: 0.4rem;
      background: #232991;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      transition: 0.3s;
      color: #fff;
    }

    .actions button:hover {
      background: #3c45b0;
    }

    /* ===== Modal ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .modal-content {
      background: #fff;
      color: #000;
      padding: 2rem;
      border-radius: 10px;
      width: 400px;
      position: relative;
      animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content h2 {
      margin-bottom: 1rem;
      color: #1e3c72;
    }

    .modal-content input, .modal-content select {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .modal-content button {
      background: #1e3c72;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.2rem;
      cursor: pointer;
      font-weight: 600;
    }

    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 1.2rem;
      cursor: pointer;
      color: #333;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Calendar Section ===== */
    .calendar-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .calendar-header button {
      background: #232991;
      border: none;
      color: #fff;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .calendar-header button:hover {
      background: #3942b7;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      background: rgba(255, 255, 255, 0.15);
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      min-height: 60px;
      position: relative;
    }

    .calendar-day:hover {
      background: rgba(0, 0, 0, 0.25);
    }

    .calendar-day.today {
      border: 2px solid #00ffa9;
      font-weight: bold;
    }

    .shift {
      font-size: 0.75rem;
      background: #00bfa6;
      color: #fff;
      border-radius: 6px;
      padding: 2px 5px;
      margin-top: 4px;
      display: inline-block;
    }

    @media (max-width: 768px) {
      .calendar-grid { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>
  <div class="background-pattern"></div>

  <div class="container">
    <header>
      <h1>Personnel Management - LogiTrack LMS</h1>
      <button onclick="openModal()">+ Add Personnel</button>
    </header>

    <div class="filters">
      <input type="text" id="searchInput" placeholder="Search by name..." onkeyup="filterTable()">
      <select id="roleFilter" onchange="filterTable()">
        <option value="">All Roles</option>
        <option value="Driver">Driver</option>
        <option value="Dispatcher">Dispatcher</option>
        <option value="Supervisor">Supervisor</option>
      </select>
    </div>

    <table id="personnelTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Role</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Status</th>
          <th>Assigned Shipments</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="personnelBody"></tbody>
    </table>

    <!-- ===== Calendar Section ===== -->
    <div class="calendar-container">
      <div class="calendar-header">
        <button id="prevMonth">‚óÄ</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth">‚ñ∂</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
  </div>

  <!-- ===== Modal ===== -->
  <div class="modal" id="personnelModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">Add Personnel</h2>
      <input type="text" id="name" placeholder="Full Name">
      <select id="role">
        <option value="Driver">Driver</option>
        <option value="Dispatcher">Dispatcher</option>
        <option value="Supervisor">Supervisor</option>
      </select>
      <input type="text" id="phone" placeholder="Phone Number">
      <input type="email" id="email" placeholder="Email Address">
      <select id="status">
        <option value="Active">Active</option>
        <option value="Off-duty">Off-duty</option>
      </select>
      <button onclick="savePersonnel()">Save</button>
    </div>
  </div>

  <script>
    /* ===== Personnel Data ===== */
    let personnel = [
      { name: "John Doe", role: "Driver", phone: "0712345678", email: "john@logitrack.com", status: "Active", shipments: 4 },
      { name: "Grace Kibet", role: "Dispatcher", phone: "0723456789", email: "grace@logitrack.com", status: "Off-duty", shipments: 2 },
      { name: "Moses Kip", role: "Supervisor", phone: "0734567890", email: "moses@logitrack.com", status: "Active", shipments: 7 },
    ];

    // index currently being edited; null when adding a new personnel
    let editingIndex = null;

    function renderPersonnel() {
      const tbody = document.getElementById("personnelBody");
      tbody.innerHTML = "";
      personnel.forEach((p, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${p.name}</td>
            <td>${p.role}</td>
            <td>${p.phone}</td>
            <td>${p.email}</td>
            <td class="${p.status === 'Active' ? 'status-active' : 'status-off'}">${p.status}</td>
            <td>${p.shipments}</td>
            <td class="actions">
              <button onclick="editPersonnel(${index})">‚úèÔ∏è</button>
              <button onclick="deletePersonnel(${index})">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      });
    }

    function filterTable() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const roleFilter = document.getElementById("roleFilter").value;
      const tbody = document.getElementById("personnelBody");
      tbody.innerHTML = "";

      // iterate original array so indices remain correct for actions
      personnel.forEach((p, idx) => {
        if (
          p.name.toLowerCase().includes(search) &&
          (roleFilter === "" || p.role === roleFilter)
        ) {
          tbody.innerHTML += `
            <tr>
              <td>${p.name}</td>
              <td>${p.role}</td>
              <td>${p.phone}</td>
              <td>${p.email}</td>
              <td class="${p.status === 'Active' ? 'status-active' : 'status-off'}">${p.status}</td>
              <td>${p.shipments}</td>
              <td class="actions">
                <button onclick="editPersonnel(${idx})">‚úèÔ∏è</button>
                <button onclick="deletePersonnel(${idx})">üóëÔ∏è</button>
              </td>
            </tr>
          `;
        }
      });
    }

    function openModal(index = null) {
      // index === null => adding new personnel; otherwise editing existing
      editingIndex = index;
      const modal = document.getElementById("personnelModal");
      const title = document.getElementById("modalTitle");
      if (index === null) {
        title.textContent = 'Add Personnel';
        // clear fields
        document.getElementById('name').value = '';
        document.getElementById('role').value = 'Driver';
        document.getElementById('phone').value = '';
        document.getElementById('email').value = '';
        document.getElementById('status').value = 'Active';
      } else {
        title.textContent = 'Edit Personnel';
        const p = personnel[index];
        document.getElementById('name').value = p.name;
        document.getElementById('role').value = p.role;
        document.getElementById('phone').value = p.phone;
        document.getElementById('email').value = p.email;
        document.getElementById('status').value = p.status;
      }
      modal.style.display = "flex";
    }
    function closeModal() { document.getElementById("personnelModal").style.display = "none"; editingIndex = null; }

    function savePersonnel() {
      const newPersonnel = {
        name: document.getElementById("name").value.trim(),
        role: document.getElementById("role").value,
        phone: document.getElementById("phone").value.trim(),
        email: document.getElementById("email").value.trim(),
        status: document.getElementById("status").value,
        shipments: 0,
      };

      if (!newPersonnel.name) { alert('Please enter a name'); return; }

      if (editingIndex === null) {
        // add new
        personnel.push(newPersonnel);
      } else {
        // update existing (preserve shipments if any)
        newPersonnel.shipments = personnel[editingIndex].shipments || 0;
        personnel[editingIndex] = newPersonnel;
      }

      closeModal();

      // refresh view depending on active filters
      const hasFilter = document.getElementById('searchInput').value.trim() !== '' || document.getElementById('roleFilter').value !== '';
      if (hasFilter) filterTable(); else renderPersonnel();
    }

    function editPersonnel(index) {
      openModal(index);
    }

    function deletePersonnel(index) {
      if (confirm("Remove " + personnel[index].name + " from the system?")) {
        personnel.splice(index, 1);
        renderPersonnel();
      }
    }

    renderPersonnel();

    /* ===== Calendar Logic ===== */
    const monthYear = document.getElementById('monthYear');
    const calendarGrid = document.getElementById('calendarGrid');
    const now = new Date();
    let currentMonth = now.getMonth();
    let currentYear = now.getFullYear();

    // persist shifts so assignments remain for future reference
    const SHIFTS_KEY = 'logitrack_personnel_shifts_v1';
    let shifts = {};
    function loadShifts(){
      try{ shifts = JSON.parse(localStorage.getItem(SHIFTS_KEY) || '{}') }catch(e){ shifts = {} }
    }
    function saveShifts(){ try{ localStorage.setItem(SHIFTS_KEY, JSON.stringify(shifts)) }catch(e){ console.error('saveShifts failed', e) } }
    function dateKey(y,m,d){ return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}` }
    loadShifts();

    function renderCalendar(month, year) {
      calendarGrid.innerHTML = '';
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });
      monthYear.textContent = `${monthName} ${year}`;

      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.classList.add('calendar-day');
        empty.style.visibility = 'hidden';
        calendarGrid.appendChild(empty);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const day = document.createElement('div');
        day.classList.add('calendar-day');
        day.innerHTML = `<strong>${d}</strong>`;

        const key = dateKey(year, month, d);

        // mark today
        if (d === now.getDate() && month === now.getMonth() && year === now.getFullYear()) {
          day.classList.add('today');
        }

        // render existing shifts for this date (if any)
        if (shifts[key] && Array.isArray(shifts[key])){
          shifts[key].forEach((name, idx)=>{
            const shift = document.createElement('div');
            shift.classList.add('shift');
            shift.textContent = name;
            shift.dataset.index = idx;
            // allow editing/deleting existing shifts by clicking the shift itself
            shift.addEventListener('click', (e)=>{
              e.stopPropagation();
              editShift(key, idx);
            });
            day.appendChild(shift);
          });
        }

        // only allow adding new assignments to present or future dates
        const dayDate = new Date(year, month, d);
        const today = new Date(); today.setHours(0,0,0,0);
        if (dayDate >= today) {
          day.addEventListener('click', () => {
            const staff = prompt(`Assign shift for ${monthName} ${d}, ${year}:`);
            if (staff && staff.trim()){
              shifts[key] = shifts[key] || [];
              shifts[key].push(staff.trim());
              saveShifts();
              renderCalendar(month, year);
            }
          });
        } else {
          // visually indicate past dates cannot be assigned
          day.style.opacity = '0.85';
          day.title = 'Cannot assign shifts to past dates';
        }

        calendarGrid.appendChild(day);
      }
    }

    function editShift(key, idx){
      const current = shifts[key] && shifts[key][idx];
      if (current === undefined) return;
      const updated = prompt('Edit name for duty (leave empty to delete):', current);
      if (updated === null) return; // user cancelled
      if (updated.trim() === ''){
        if (confirm('Delete this assignment?')){
          shifts[key].splice(idx,1);
          if (shifts[key].length === 0) delete shifts[key];
          saveShifts();
          renderCalendar(currentMonth, currentYear);
        }
        return;
      }
      shifts[key][idx] = updated.trim();
      saveShifts();
      renderCalendar(currentMonth, currentYear);
    }

    document.getElementById('prevMonth').onclick = () => {
      currentMonth--;
      if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      renderCalendar(currentMonth, currentYear);
    };

    document.getElementById('nextMonth').onclick = () => {
      currentMonth++;
      if (currentMonth > 11) { currentMonth = 0; currentYear++; }
      renderCalendar(currentMonth, currentYear);
    };

    renderCalendar(currentMonth, currentYear);
  </script>
</body>
</html>
